<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeckView - ÊñáÊ°£Êü•ÁúãÂô®</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <!-- marked.js for Markdown -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
    <!-- DOMPurify for XSS protection -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    <!-- highlight.js for code highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- CodeMirror for Markdown editing -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/markdown/markdown.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- ‰æßËæπÊ†è - ÁõÆÂΩïÊ†ë -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1 class="logo"><span class="logo-title">DeckView</span><span class="logo-author">written by zzy</span></h1>
                <span class="root-dir" title="{{ content_dir }}">üìÅ {{ content_dir }}</span>
            </div>

            <!-- ÊêúÁ¥¢Ê°Ü -->
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="ÊêúÁ¥¢Êñá‰ª∂..." autocomplete="off">
                <span class="search-icon">üîç</span>
            </div>

            <!-- Â∑•ÂÖ∑Ê†è -->
            <div class="toolbar">
                <button class="btn-icon" id="uploadBtn" title="‰∏ä‰º†Êñá‰ª∂">üì§</button>
                <button class="btn-icon" id="newFileBtn" title="Êñ∞Âª∫Êñá‰ª∂">üìù</button>
                <button class="btn-icon" id="refreshBtn" title="Âà∑Êñ∞">üîÑ</button>
                <button class="btn-icon" id="expandAllBtn" title="ÂÖ®ÈÉ®Â±ïÂºÄ">üìÇ</button>
                <button class="btn-icon" id="collapseAllBtn" title="ÂÖ®ÈÉ®ÊäòÂè†">üìÅ</button>
            </div>

            <!-- ÁõÆÂΩïÊ†ë -->
            <nav class="file-tree" id="fileTree">
                <div class="loading">Âä†ËΩΩ‰∏≠...</div>
            </nav>

            <!-- ÁªüËÆ°‰ø°ÊÅØ -->
            <div class="sidebar-footer" id="sidebarFooter">
                <span class="file-count">ÂÖ± 0 ‰∏™Êñá‰ª∂</span>
            </div>
        </aside>

        <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
        <main class="main-content" id="mainContent">
            <!-- Ê¨¢ËøéÈ°µÈù¢ -->
            <div class="welcome-page" id="welcomePage">
                <div class="welcome-icon">üìö</div>
                <h2>Ê¨¢Ëøé‰ΩøÁî® DeckView</h2>
                <p>‰ªéÂ∑¶‰æßÁõÆÂΩïÊ†ëÈÄâÊã©‰∏Ä‰∏™Êñá‰ª∂ÂºÄÂßãÈ¢ÑËßà</p>
                <p class="author">written by zzy</p>
                <div class="supported-types">
                    <span class="type-badge pptx">üìä PPT/PPTX</span>
                    <span class="type-badge pdf">üìÑ PDF</span>
                    <span class="type-badge docx">üìÉ Word</span>
                    <span class="type-badge markdown">üìù Markdown</span>
                </div>
            </div>

            <!-- È¢ÑËßàÂå∫Âüü (ÈªòËÆ§ÈöêËóè) -->
            <div class="preview-panel" id="previewPanel" style="display: none;">
                <!-- È¢ÑËßàÂ∑•ÂÖ∑Ê†è -->
                <div class="preview-toolbar" id="previewToolbar">
                    <div class="toolbar-left">
                        <span class="preview-title" id="previewTitle">Êñá‰ª∂Âêç</span>
                    </div>
                    <div class="toolbar-center">
                        <!-- PDF È°µÈù¢ÊéßÂà∂ -->
                        <div class="page-controls" id="previewPageControls" style="display: none;">
                            <button class="btn-icon" id="previewPrevPage" title="‰∏ä‰∏ÄÈ°µ">‚óÄ</button>
                            <span class="page-info">
                                <input type="number" id="previewCurrentPage" min="1" value="1"> / <span id="previewTotalPages">1</span>
                            </span>
                            <button class="btn-icon" id="previewNextPage" title="‰∏ã‰∏ÄÈ°µ">‚ñ∂</button>
                        </div>
                    </div>
                    <div class="toolbar-right">
                        <!-- ÁîªÁ¨îÂ∑•ÂÖ∑Ê†è -->
                        <div class="pen-tools" id="previewPenTools" style="display: none;">
                            <button class="btn-icon" id="previewPenToggle" title="ÁîªÁ¨î">‚úèÔ∏è</button>
                            <div class="pen-brush-options" id="previewPenBrushOptions" style="display: none;">
                                <div class="color-presets">
                                    <button class="color-btn active" data-color="#ff0000" style="background:#ff0000" title="Á∫¢Ëâ≤"></button>
                                    <button class="color-btn" data-color="#ff6600" style="background:#ff6600" title="Ê©ôËâ≤"></button>
                                    <button class="color-btn" data-color="#ffcc00" style="background:#ffcc00" title="ÈªÑËâ≤"></button>
                                    <button class="color-btn" data-color="#00cc00" style="background:#00cc00" title="ÁªøËâ≤"></button>
                                    <button class="color-btn" data-color="#0066ff" style="background:#0066ff" title="ËìùËâ≤"></button>
                                    <button class="color-btn" data-color="#9900ff" style="background:#9900ff" title="Á¥´Ëâ≤"></button>
                                </div>
                                <input type="color" id="previewPenColor" value="#ff0000" title="Ëá™ÂÆö‰πâÈ¢úËâ≤">
                                <select id="previewPenSize" title="ÁîªÁ¨îÂ§ßÂ∞è">
                                    <option value="2">ÁªÜ</option>
                                    <option value="4" selected>‰∏≠</option>
                                    <option value="8">Á≤ó</option>
                                </select>
                            </div>
                            <span class="tool-separator">|</span>
                            <button class="btn-icon" id="previewPenEraser" title="Ê©°ÁöÆÊì¶">üßΩ</button>
                            <div class="pen-eraser-options" id="previewPenEraserOptions" style="display: none;">
                                <select id="previewEraserSize" title="Ê©°ÁöÆÊì¶Â§ßÂ∞è">
                                    <option value="10">Â∞è</option>
                                    <option value="20" selected>‰∏≠</option>
                                    <option value="40">Â§ß</option>
                                </select>
                            </div>
                            <span class="tool-separator">|</span>
                            <button class="btn-icon" id="previewPenClear" title="Ê∏ÖÈô§">üóëÔ∏è</button>
                            <button class="btn-icon" id="previewPenUndo" title="Êí§ÈîÄ">‚Ü©Ô∏è</button>
                            <button class="btn-icon" id="previewPenRedo" title="ÈáçÂÅö">‚Ü™Ô∏è</button>
                        </div>
                        <!-- Áº©ÊîæÊéßÂà∂ -->
                        <div class="zoom-controls" id="previewZoomControls" style="display: none;">
                            <button class="btn-icon" id="previewZoomOut" title="Áº©Â∞è">‚àí</button>
                            <span class="zoom-level" id="previewZoomLevel">100%</span>
                            <button class="btn-icon" id="previewZoomIn" title="ÊîæÂ§ß">+</button>
                            <button class="btn-icon" id="previewFitPage" title="ÈÄÇÂêàÈ°µÈù¢">‚ä°</button>
                        </div>
                        <!-- Markdown ÁºñËæëÊåâÈíÆ -->
                        <button class="btn-icon md-btn" id="previewMdEdit" title="ÁºñËæë" style="display: none;">
                            <span class="btn-text">ÁºñËæë</span>
                        </button>
                        <button class="btn-icon md-btn" id="previewMdSave" title="‰øùÂ≠ò" style="display: none;">
                            <span class="btn-text">üíæ</span>
                        </button>
                        <span class="md-status" id="previewMdStatus"></span>
                        <!-- ÂçïÁã¨Êü•ÁúãÊåâÈíÆ -->
                        <button class="btn-icon open-btn" id="openInNewPage" title="ÂçïÁã¨Êü•Áúã">
                            <span class="btn-text">‚Üó ÂçïÁã¨Êü•Áúã</span>
                        </button>
                    </div>
                </div>

                <!-- È¢ÑËßàÂÜÖÂÆπÂå∫Âüü -->
                <div class="preview-content" id="previewContent">
                    <!-- PDF Êü•ÁúãÂô® -->
                    <div class="pdf-viewer" id="previewPdfViewer" style="display: none;">
                        <div class="pdf-container" id="previewPdfContainer">
                            <canvas id="previewPdfCanvas"></canvas>
                            <canvas id="previewDrawingCanvas" class="drawing-canvas"></canvas>
                        </div>
                    </div>

                    <!-- Markdown Êü•ÁúãÂô® -->
                    <div class="markdown-viewer" id="previewMarkdownViewer" style="display: none;">
                        <div class="md-container">
                            <div class="md-editor-pane" id="previewMdEditorPane" style="display: none;">
                                <textarea id="previewMdEditor"></textarea>
                            </div>
                            <div class="md-resizer" id="previewMdResizer" style="display: none;"></div>
                            <div class="md-preview-pane" id="previewMdPreviewPane">
                                <article class="markdown-body" id="previewMarkdownContent"></article>
                            </div>
                        </div>
                    </div>

                    <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
                    <div class="preview-loading" id="previewLoading" style="display: none;">
                        <div class="spinner"></div>
                        <p id="previewLoadingText">Ê≠£Âú®Âä†ËΩΩ...</p>
                    </div>

                    <!-- ÈîôËØØÁä∂ÊÄÅ -->
                    <div class="preview-error" id="previewError" style="display: none;">
                        <div class="error-icon">‚ö†Ô∏è</div>
                        <p id="previewErrorText">Âä†ËΩΩÂ§±Ë¥•</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ‰∏ªÈ¢òÂàáÊç¢ÊåâÈíÆ -->
    <button class="theme-toggle" id="themeToggle" title="ÂàáÊç¢‰∏ªÈ¢ò">üåó</button>

    <!-- ËøûÊé•Áä∂ÊÄÅÊåáÁ§∫Âô® -->
    <div class="connection-status" id="connectionStatus" title="Êñá‰ª∂ÁõëÂê¨Áä∂ÊÄÅ">
        <span class="status-dot"></span>
        <span class="status-text">ËøûÊé•‰∏≠...</span>
    </div>

    <!-- Ê∂àÊÅØÊèêÁ§∫ -->
    <div class="toast" id="toast"></div>

    <!-- ‰∏ä‰º†Ê®°ÊÄÅÊ°Ü -->
    <div class="modal-overlay" id="uploadModal" style="display: none;">
        <div class="modal-content upload-modal">
            <div class="modal-header">
                <h3>‰∏ä‰º†Êñá‰ª∂</h3>
                <button class="btn-icon modal-close" id="uploadModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Êñá‰ª∂ÊãñÊîæÂå∫Âüü -->
                <div class="upload-dropzone" id="uploadDropzone">
                    <div class="dropzone-icon">üìÅ</div>
                    <p class="dropzone-text">ÊãñÊîæÊñá‰ª∂Âà∞Ê≠§Â§ÑÔºåÊàñÁÇπÂáªÈÄâÊã©Êñá‰ª∂</p>
                    <p class="dropzone-hint">ÊîØÊåÅÔºöPDF, PPT/PPTX, Word, Markdown</p>
                    <input type="file" id="uploadFileInput"
                           accept=".pdf,.ppt,.pptx,.doc,.docx,.md,.markdown"
                           style="display: none;">
                </div>

                <!-- Â∑≤ÈÄâÊñá‰ª∂È¢ÑËßà -->
                <div class="upload-file-preview" id="uploadFilePreview" style="display: none;">
                    <span class="file-icon" id="uploadFileIcon">üìÑ</span>
                    <span class="file-name" id="uploadFileName"></span>
                    <button class="btn-icon remove-file" id="uploadRemoveFile" title="ÁßªÈô§">&times;</button>
                </div>

                <!-- ÁõÆÊ†áÁõÆÂΩïÈÄâÊã© -->
                <div class="upload-target">
                    <label>‰∏ä‰º†Âà∞ÁõÆÂΩïÔºö</label>
                    <div class="upload-dir-tree" id="uploadDirTree">
                        <!-- ÁõÆÂΩïÊ†ëÂ∞ÜÁî±JavaScriptÊ∏≤Êüì -->
                    </div>
                    <div class="upload-selected-path" id="uploadSelectedPath">
                        <span class="path-label">Â∑≤ÈÄâÊã©:</span>
                        <span class="path-value" id="uploadSelectedPathValue">Ê†πÁõÆÂΩï</span>
                    </div>
                </div>

                <!-- ‰∏ä‰º†ËøõÂ∫¶ -->
                <div class="upload-progress" id="uploadProgress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="uploadProgressFill"></div>
                    </div>
                    <span class="progress-text" id="uploadProgressText">0%</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="uploadCancelBtn">ÂèñÊ∂à</button>
                <button class="btn btn-primary" id="uploadSubmitBtn" disabled>‰∏ä‰º†</button>
            </div>
        </div>
    </div>

    <!-- Êñ∞Âª∫Êñá‰ª∂Ê®°ÊÄÅÊ°Ü -->
    <div class="modal-overlay" id="createModal" style="display: none;">
        <div class="modal-content create-modal">
            <div class="modal-header">
                <h3>Êñ∞Âª∫ Markdown Êñá‰ª∂</h3>
                <button class="btn-icon modal-close" id="createModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <!-- ÁõÆÊ†áÁõÆÂΩïÊòæÁ§∫ -->
                <div class="create-target-dir">
                    <span class="target-label">ÂàõÂª∫‰ΩçÁΩÆÔºö</span>
                    <span class="target-path" id="createTargetPath">Ê†πÁõÆÂΩï</span>
                </div>

                <!-- Êñá‰ª∂ÂêçËæìÂÖ• -->
                <div class="create-filename-group">
                    <label for="createFilename">Êñá‰ª∂Âêç</label>
                    <div class="filename-input-wrapper">
                        <input type="text" id="createFilename" placeholder="ËæìÂÖ•Êñá‰ª∂Âêç" autocomplete="off">
                        <span class="filename-suffix">.md</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="createCancelBtn">ÂèñÊ∂à</button>
                <button class="btn btn-primary" id="createSubmitBtn" disabled>ÂàõÂª∫</button>
            </div>
        </div>
    </div>

    <!-- ‰∏ªÈ¢òËÑöÊú¨ÔºàÂú®ÂÖ∂‰ªñËÑöÊú¨‰πãÂâçÂä†ËΩΩÔºåÈÅøÂÖçÈó™ÁÉÅÔºâ -->
    <script src="/static/js/theme.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
