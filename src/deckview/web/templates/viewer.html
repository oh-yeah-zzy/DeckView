<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊñáÊ°£Êü•ÁúãÂô® - DeckView</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/viewer.css">
    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <!-- marked.js for Markdown -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
    <!-- DOMPurify for XSS protection -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    <!-- highlight.js for code highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- CodeMirror for Markdown editing -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/markdown/markdown.min.js"></script>
</head>
<body class="viewer-body">
    <!-- È°∂ÈÉ®Â∑•ÂÖ∑Ê†è -->
    <header class="viewer-header">
        <div class="header-left">
            <a href="/" class="back-btn" title="ËøîÂõûÈ¶ñÈ°µ">‚Üê ËøîÂõû</a>
            <span class="doc-title" id="docTitle">Âä†ËΩΩ‰∏≠...</span>
        </div>
        <div class="header-center">
            <div class="page-controls" id="pageControls" style="display: none;">
                <button class="btn-icon" id="prevPage" title="‰∏ä‰∏ÄÈ°µ">‚óÄ</button>
                <span class="page-info">
                    <input type="number" id="currentPage" min="1" value="1"> / <span id="totalPages">1</span>
                </span>
                <button class="btn-icon" id="nextPage" title="‰∏ã‰∏ÄÈ°µ">‚ñ∂</button>
            </div>
        </div>
        <div class="header-right">
            <!-- ÁîªÁ¨îÂ∑•ÂÖ∑Ê†è -->
            <div class="pen-tools" id="penTools" style="display: none;">
                <!-- ÁîªÁ¨îÊåâÈíÆ -->
                <button class="btn-icon" id="penToggle" title="ÁîªÁ¨î">‚úèÔ∏è</button>
                <!-- ÁîªÁ¨îÈÄâÈ°πÔºàÁîªÁ¨îÊøÄÊ¥ªÊó∂ÊòæÁ§∫Ôºâ -->
                <div class="pen-brush-options" id="penBrushOptions" style="display: none;">
                    <div class="color-presets">
                        <button class="color-btn active" data-color="#ff0000" style="background:#ff0000" title="Á∫¢Ëâ≤"></button>
                        <button class="color-btn" data-color="#ff6600" style="background:#ff6600" title="Ê©ôËâ≤"></button>
                        <button class="color-btn" data-color="#ffcc00" style="background:#ffcc00" title="ÈªÑËâ≤"></button>
                        <button class="color-btn" data-color="#00cc00" style="background:#00cc00" title="ÁªøËâ≤"></button>
                        <button class="color-btn" data-color="#0066ff" style="background:#0066ff" title="ËìùËâ≤"></button>
                        <button class="color-btn" data-color="#9900ff" style="background:#9900ff" title="Á¥´Ëâ≤"></button>
                        <button class="color-btn" data-color="#ffffff" style="background:#ffffff" title="ÁôΩËâ≤"></button>
                        <button class="color-btn" data-color="#000000" style="background:#000000" title="ÈªëËâ≤"></button>
                    </div>
                    <input type="color" id="penColor" value="#ff0000" title="Ëá™ÂÆö‰πâÈ¢úËâ≤">
                    <select id="penSize" title="ÁîªÁ¨îÂ§ßÂ∞è">
                        <option value="2">ÁªÜ</option>
                        <option value="4" selected>‰∏≠</option>
                        <option value="8">Á≤ó</option>
                        <option value="16">ÁâπÁ≤ó</option>
                    </select>
                </div>
                <span class="tool-separator">|</span>
                <!-- Ê©°ÁöÆÊì¶ÊåâÈíÆ -->
                <button class="btn-icon" id="penEraser" title="Ê©°ÁöÆÊì¶">üßΩ</button>
                <!-- Ê©°ÁöÆÊì¶ÈÄâÈ°πÔºàÊ©°ÁöÆÊì¶ÊøÄÊ¥ªÊó∂ÊòæÁ§∫Ôºâ -->
                <div class="pen-eraser-options" id="penEraserOptions" style="display: none;">
                    <select id="eraserSize" title="Ê©°ÁöÆÊì¶Â§ßÂ∞è">
                        <option value="10">Â∞è</option>
                        <option value="20" selected>‰∏≠</option>
                        <option value="40">Â§ß</option>
                        <option value="80">ÁâπÂ§ß</option>
                    </select>
                </div>
                <span class="tool-separator">|</span>
                <!-- Ê∏ÖÈô§ÂíåÊí§ÈîÄ -->
                <button class="btn-icon" id="penClear" title="Ê∏ÖÈô§ÂÖ®ÈÉ®">üóëÔ∏è</button>
                <button class="btn-icon" id="penUndo" title="Êí§ÈîÄ">‚Ü©Ô∏è</button>
                <button class="btn-icon" id="penRedo" title="ÈáçÂÅö">‚Ü™Ô∏è</button>
            </div>
            <div class="zoom-controls" id="zoomControls" style="display: none;">
                <button class="btn-icon" id="zoomOut" title="Áº©Â∞è">‚àí</button>
                <span class="zoom-level" id="zoomLevel">100%</span>
                <button class="btn-icon" id="zoomIn" title="ÊîæÂ§ß">+</button>
                <button class="btn-icon" id="fitPage" title="ÈÄÇÂêàÈ°µÈù¢">‚ä°</button>
                <button class="btn-icon" id="fitWidth" title="ÈÄÇÂêàÂÆΩÂ∫¶">‚Üî</button>
            </div>
            <button class="btn-icon" id="fullscreen" title="ÂÖ®Â±è">‚õ∂</button>
        </div>
    </header>

    <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
    <div class="viewer-main">
        <!-- ‰æßËæπÊ†è - Áº©Áï•Âõæ -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <span>È°µÈù¢ÂØºËà™</span>
                <button class="btn-icon sidebar-toggle" id="sidebarToggle">‚óÄ</button>
            </div>
            <div class="thumbnail-list" id="thumbnailList"></div>
        </aside>

        <!-- ‰æßËæπÊ†èÂ±ïÂºÄÊåâÈíÆÔºà‰æßËæπÊ†èÊî∂Ëµ∑Êó∂ÊòæÁ§∫Ôºâ -->
        <button class="sidebar-expand-btn" id="sidebarExpandBtn" title="Â±ïÂºÄÈ°µÈù¢ÂØºËà™">‚ñ∂</button>

        <!-- Êü•ÁúãÂô®‰∏ªÂå∫Âüü -->
        <main class="viewer-content" id="viewerContent">
            <!-- PDFÊü•ÁúãÂô® -->
            <div class="pdf-viewer" id="pdfViewer" style="display: none;">
                <div class="pdf-container" id="pdfContainer">
                    <canvas id="pdfCanvas"></canvas>
                    <canvas id="drawingCanvas" class="drawing-canvas"></canvas>
                </div>
            </div>

            <!-- MarkdownÊü•ÁúãÂô® - ÊîØÊåÅÁºñËæëÊ®°Âºè -->
            <div class="markdown-viewer" id="markdownViewer" style="display: none;">
                <!-- Markdown Â∑•ÂÖ∑Ê†è -->
                <div class="md-toolbar" id="mdToolbar">
                    <div class="md-toolbar-left">
                        <button class="btn-icon md-btn" id="mdModeToggle" title="ÂàáÊç¢ÁºñËæëÊ®°Âºè">
                            <span class="btn-text">ÁºñËæë</span>
                        </button>
                    </div>
                    <div class="md-toolbar-center">
                        <span class="md-status" id="mdStatus"></span>
                    </div>
                    <div class="md-toolbar-right">
                        <button class="btn-icon md-btn" id="mdSave" title="‰øùÂ≠ò (Ctrl+S)" style="display: none;">
                            <span class="btn-text">üíæ ‰øùÂ≠ò</span>
                        </button>
                    </div>
                </div>

                <!-- ÂàÜÊ†èÂÆπÂô® -->
                <div class="md-container">
                    <!-- ÁºñËæëÂô®Èù¢Êùø (ÈªòËÆ§ÈöêËóè) -->
                    <div class="md-editor-pane" id="mdEditorPane" style="display: none;">
                        <textarea id="mdEditor"></textarea>
                    </div>

                    <!-- ÂàÜÈöîÁ∫ø (ÁºñËæëÊ®°ÂºèÊòæÁ§∫) -->
                    <div class="md-resizer" id="mdResizer" style="display: none;"></div>

                    <!-- È¢ÑËßàÈù¢Êùø -->
                    <div class="md-preview-pane" id="mdPreviewPane">
                        <article class="markdown-body" id="markdownContent"></article>
                    </div>
                </div>
            </div>

            <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
            <div class="viewer-loading" id="viewerLoading">
                <div class="spinner"></div>
                <p id="loadingText">Ê≠£Âú®Âä†ËΩΩÊñáÊ°£...</p>
            </div>

            <!-- ÈîôËØØÁä∂ÊÄÅ -->
            <div class="viewer-error" id="viewerError" style="display: none;">
                <div class="error-icon">‚ö†Ô∏è</div>
                <p id="errorText">Âä†ËΩΩÂ§±Ë¥•</p>
                <button class="btn" onclick="location.reload()">ÈáçËØï</button>
            </div>
        </main>
    </div>

    <!-- ‰∏ªÈ¢òÂàáÊç¢ÊåâÈíÆ -->
    <button class="theme-toggle" id="themeToggle" title="ÂàáÊç¢‰∏ªÈ¢ò">üåó</button>

    <!-- ÊñáÊ°£IDÂ≠òÂÇ®ÔºàÁî±Ê®°ÊùøÊ∏≤ÊüìÔºâ -->
    <script>
        window.DOC_ID = "{{ doc_id }}";
    </script>
    <!-- ‰∏ªÈ¢òËÑöÊú¨ÔºàÂú®ÂÖ∂‰ªñËÑöÊú¨‰πãÂâçÂä†ËΩΩÔºåÈÅøÂÖçÈó™ÁÉÅÔºâ -->
    <script src="/static/js/theme.js"></script>
    <script src="/static/js/viewer.js"></script>
</body>
</html>
